-- A) Limpiezas de tanque (histórico)
CREATE TABLE IF NOT EXISTS TANQUE_LIMPIEZA(
ID INTEGER PRIMARY KEY AUTOINCREMENT,
TANQUE_ID INTEGER NOT NULL REFERENCES TANQUE(ID) ON DELETE CASCADE,
FECHA TEXT NOT NULL, -- yyyy-MM-dd
RESPONSABLE TEXT,
DESCRIPCION TEXT,
OBSERVACIONES TEXT
);
CREATE INDEX IF NOT EXISTS IX_TL_TANQUE_FECHA ON TANQUE_LIMPIEZA(TANQUE_ID, FECHA);


-- B) Recuperación de contraseña (tokens de un solo uso)
CREATE TABLE IF NOT EXISTS PASSWORD_RESET(
ID INTEGER PRIMARY KEY AUTOINCREMENT,
USER_ID INTEGER NOT NULL REFERENCES USERS(ID) ON DELETE CASCADE,
TOKEN TEXT NOT NULL UNIQUE,
EXPIRA TEXT NOT NULL -- ISO-8601, ej: 2025-11-11T23:59:59
);
CREATE INDEX IF NOT EXISTS IX_RESET_USER ON PASSWORD_RESET(USER_ID);

-- Historial de limpiezas por tanque
CREATE TABLE IF NOT EXISTS TANQUE_LIMPIEZA (
  id          INTEGER PRIMARY KEY AUTOINCREMENT,
  tanque_id   INTEGER NOT NULL,
  fecha       TEXT    NOT NULL,              -- ISO yyyy-MM-dd
  responsable TEXT    NOT NULL,
  descripcion TEXT    NOT NULL,
  created_at  TEXT    DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (tanque_id) REFERENCES TANQUE(id) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_limpieza_tanque_fecha
  ON TANQUE_LIMPIEZA(tanque_id, fecha);
