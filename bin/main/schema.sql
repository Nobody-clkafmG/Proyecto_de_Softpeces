CREATE TABLE IF NOT EXISTS USERS (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  USERNAME TEXT UNIQUE NOT NULL,
  PASS_HASH TEXT NOT NULL,
  ACTIVE INTEGER NOT NULL DEFAULT 1
);

CREATE TABLE IF NOT EXISTS ROLES (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  NAME TEXT UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS USER_ROLES (
  USER_ID INT NOT NULL,
  ROLE_ID INT NOT NULL
);

CREATE TABLE IF NOT EXISTS ESTACION (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  NOMBRE TEXT UNIQUE NOT NULL,
  ENCARGADO TEXT NOT NULL,
  GEOUBICACION TEXT,
  TIPO_PEZ TEXT,
  LITROS_APROX REAL,
  PECES_APROX INTEGER,
  FECHA_INICIO TEXT,
  CANTIDAD_TANQUES INTEGER
);

CREATE TABLE IF NOT EXISTS TANQUE (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  ESTACION_ID INT NOT NULL,
  CODIGO TEXT NOT NULL,
  CAPACIDAD_L REAL NOT NULL,
  TIPO_PEZ TEXT,
  PECES_APROX INTEGER,
  FECHA_INICIO TEXT,
  UNIQUE(ESTACION_ID, CODIGO),
  FOREIGN KEY (ESTACION_ID) REFERENCES ESTACION(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS LOTE (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  NOMBRE TEXT NOT NULL,
  ESTADO TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS MUESTREO (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  LOTE_ID INT NOT NULL,
  ESTACION_ID INT NOT NULL,
  TANQUE_ID INT NOT NULL,
  FECHA_HORA TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS FOTO (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  MUESTREO_ID INT,
  ESTACION_ID INT,
  TANQUE_ID INT,
  PARTE TEXT NOT NULL,
  RUTA TEXT NOT NULL,
  QC_OK INTEGER NOT NULL,
  ESTADO TEXT NOT NULL,
  LABEL TEXT,
  PROB REAL,
  MENSAJE_ERROR TEXT,
  FOREIGN KEY (ESTACION_ID) REFERENCES ESTACION(ID) ON DELETE CASCADE,
  FOREIGN KEY (TANQUE_ID) REFERENCES TANQUE(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS BITACORA (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  USERNAME TEXT,
  ACCION TEXT,
  ENTIDAD TEXT,
  ENTIDAD_ID INT,
  FECHA_HORA TEXT NOT NULL,
  DETALLE TEXT
);
